---
Prepare the Targets (Remote Nodes)

- name: TARGET - Ensure the user {{ bootstrap_user }} exists
  ansible.builtin.user:
    name: "{{ bootstrap_user }}"
    shell: /bin/zsh
    groups: "{{ admin_group }}"
    append: yes
    create_home: yes

- name: TARGET - Configure passwordless sudo
  ansible.builtin.copy:
    dest: "/etc/sudoers.d/{{ bootstrap_user }}"
    content: "%{{ admin_group }} ALL=(ALL) NOPASSWD: ALL"
    owner: root
    group: root
    mode: '0440'
    validate: '/usr/sbin/visudo -cf %s'
