---
- name: Setup Ansible user with sudo access
- hosts: localhost
  connection: local
  
  tasks:
    - name: Create ansible user
      user:
        name: ansible
        groups: sudo  # optional
        shell: /bin/bash
        create_home: true

    - name: Add ansible sudoers entry
      copy:
        dest: /etc/sudoers.d/ansible
        content: "ansible ALL=(ALL) NOPASSWD: ALL\n"
        owner: root
        group: root
        mode: '0440'  # REQUIRED for sudo to read it
        validate: '/usr/sbin/visudo -cf %s'  # Syntax check before write
