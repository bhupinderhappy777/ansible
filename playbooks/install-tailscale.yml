---
# Main playbook to install Tailscale on all cloud VMs
- hosts: localhost
  connection: local

  # Fix 1: Use ABSOLUTE playbook_dir path
  vars_files:
    - "{{ playbook_dir }}/vars/example.yml"
  
  pre_tasks:
    - name: TEST - Vars loaded?
      debug:
        msg: |
          Playbook dir: {{ playbook_dir }}
          Auth key status: {{ 'LOADED' if tailscale_auth_key is defined and tailscale_auth_key != '' else 'MISSING' }}
          Auth key preview: {{ tailscale_auth_key[0:10] if tailscale_auth_key is defined else 'NONE' }}
      no_log: true
  
  roles:
    - tailscale

  tasks:

    - name: Debug auth key loaded?
      debug:
        msg: "Auth key: {{ tailscale_auth_key | default('MISSING') }}"
        verbosity: 1  # Only shows with -v
  
    - name: Display completion message
      debug:
        msg: "Tailscale installation completed on {{ inventory_hostname }}"
