---
- name: Install Essential Tools (Shell Bypass - dnf5 Safe)
  hosts: all
  become: true
  gather_facts: true

  tasks:
    - name: Install tools (universal shell - dnf5 safe)
      shell: |
        set -e
        if command -v apt >/dev/null; then
          apt-get update -qq
          apt-get install -y -qq htop sysstat traceroute iproute2 curl wget
        elif command -v dnf >/dev/null; then
          dnf install -y htop sysstat traceroute iproute curl wget
        elif command -v yum >/dev/null; then
          yum install -y htop sysstat traceroute iproute curl wget
        fi
      changed_when: false  # Idempotent

    - name: List installed tools
      shell: "{{ item }} --version 2>/dev/null | head -1 || echo '{{ item }} missing'"
      loop:
        - htop
        - sar
        - traceroute
        - curl
      changed_when: false
