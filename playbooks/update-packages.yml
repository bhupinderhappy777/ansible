---
- name: Update all packages
  hosts: all
  become: yes

  tasks:
    - name: Full system upgrade
      package:
        upgrade: dist  # Full distro upgrade (apt dist, dnf full, yum latest)
      register: upgrade_result

    - name: Reboot if kernel updated (universal)
      reboot:
        reboot_timeout: 300
      when: "'kernel' in upgrade_result.msg or upgrade_result is changed"

    - name: Display upgrade summary
      debug:
        msg: "Upgraded {{ upgrade_result.changed | default(false) | ternary('yes', 'no') }} packages on {{ inventory_hostname }}"
